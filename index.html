<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¡œë´‡ì²­ì†Œê¸° KPI ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container { max-width: 1600px; margin: 0 auto; width: 100%; }

        /* â”€â”€ í—¤ë” â”€â”€ */
        header {
            background: white;
            padding: 28px 30px 22px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 25px;
            text-align: center;
        }
        h1 { color: #2d3748; font-size: 2.2em; font-weight: 700; letter-spacing: -0.5px; }

        /* â”€â”€ ë‚ ì§œ í•„í„° â”€â”€ */
        .date-filter {
            background: white; padding: 20px 25px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 25px;
            display: flex; align-items: center; justify-content: center;
            gap: 18px; flex-wrap: wrap;
        }
        .date-filter label { font-weight: 600; color: #2d3748; font-size: 1em; }
        .date-filter input[type="date"] {
            padding: 9px 13px; border: 2px solid #e2e8f0;
            border-radius: 8px; font-size: 0.95em; color: #2d3748;
        }
        .date-filter button {
            padding: 9px 22px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 0.95em; font-weight: 600; cursor: pointer; transition: opacity 0.2s;
        }
        .date-filter button:hover { opacity: 0.88; }
        .btn-refresh { background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important; }

        /* â”€â”€ ë‚ ì§œ ë²”ìœ„ â”€â”€ */
        .date-range {
            text-align: center; color: white; font-size: 1em;
            margin-bottom: 20px; background: rgba(255,255,255,0.2);
            padding: 12px 18px; border-radius: 10px;
        }
        .date-info {
            display: inline-block; background: rgba(255,255,255,0.3);
            padding: 4px 11px; border-radius: 5px; margin: 0 4px; font-weight: 600;
        }

        /* â”€â”€ ì°¨íŠ¸ ê·¸ë¦¬ë“œ â”€â”€ */
        .chart-grid {
            display: grid; grid-template-columns: repeat(2, 1fr);
            gap: 28px; margin-bottom: 28px;
        }
        .chart-container {
            background: white; padding: 22px 20px 16px;
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .chart-title {
            font-size: 1.25em; font-weight: 600; color: #2d3748;
            margin-bottom: 16px; text-align: center;
            padding-bottom: 12px; border-bottom: 3px solid #667eea;
        }
        canvas { max-height: 400px; }

        /* â”€â”€ ë§ˆì¼€íŒ… ì´ë²¤íŠ¸ í•˜ë‹¨ ë²”ë¡€ (ê³µí†µ ë˜í¼) â”€â”€ */
        .marketing-legend {
            display: flex; align-items: center; justify-content: center;
            gap: 6px 16px; flex-wrap: wrap;
            margin-top: 12px; padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }
        .ml-item {
            display: flex; align-items: center; gap: 6px;
            font-size: 0.74em; color: #555; font-weight: 500;
            white-space: nowrap;
        }

        /* â”€â”€ ê³µí†µ ë²”ë¡€ ì•„ì´ì½˜ ê¸°ë³¸ â”€â”€ */
        .ml-box {
            width: 16px; height: 12px; border-radius: 3px; flex-shrink: 0;
        }
        .ml-dash {
            width: 20px; height: 0; flex-shrink: 0;
        }

        /* 25ë…„ ë¡œë³´ë½ = ì´ˆë¡ */
        .ml-box-green  { background: rgba(34,197,94,0.2);  border: 1.5px solid rgba(34,197,94,0.6); }
        .ml-dash-green { border-top: 2.5px dashed rgba(22,163,74,0.9); }

        /* 26ë…„ ë¡œë³´ë½ = ë¹¨ê°• */
        .ml-box-red    { background: rgba(220,38,38,0.15); border: 1.5px solid rgba(220,38,38,0.55); }
        .ml-dash-red   { border-top: 2.5px dashed rgba(220,38,38,0.9); }

        /* ì‚¼ì„± = ì§„íŒŒë‘ */
        .ml-box-samsung  { background: rgba(30,64,175,0.15); border: 1.5px solid rgba(30,64,175,0.5); }
        .ml-dash-samsung { border-top: 2.5px dashed rgba(30,64,175,0.9); }

        /* ë“œë¦¬ë¯¸ = í•˜ëŠ˜íŒŒë‘ */
        .ml-box-dreame   { background: rgba(96,165,250,0.2); border: 1.5px solid rgba(96,165,250,0.7); }
        .ml-dash-dreame  { border-top: 2.5px dashed rgba(96,165,250,1); }

        /* â”€â”€ êµ¬ë¶„ì„  â”€â”€ */
        .ml-divider {
            width: 1px; height: 14px;
            background: #ddd; flex-shrink: 0; margin: 0 4px;
        }

        /* â”€â”€ ì¼ë°˜ í…ìŠ¤íŠ¸ ë²”ë¡€ â”€â”€ */
        .legend-info { font-size: 0.82em; color: #718096; margin-top: 10px; text-align: center; }

        /* â”€â”€ ìƒíƒœ / ë¡œë”© â”€â”€ */
        .status { text-align: center; padding: 10px; border-radius: 5px; margin-bottom: 18px; font-weight: 600; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error   { background: #f8d7da; color: #721c24; }
        .hide { display: none; }
        .loading-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.7); display:flex;
            justify-content:center; align-items:center; z-index:9999;
        }
        .loading-content { background:white; padding:40px; border-radius:15px; text-align:center; max-width:90%; }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #667eea;
            border-radius: 50%; width:50px; height:50px;
            animation: spin 1s linear infinite; margin: 0 auto 20px;
        }
        @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

        /* â”€â”€ íƒœë¸”ë¦¿ â”€â”€ */
        @media (max-width:1200px) and (min-width:769px) {
            .chart-grid { grid-template-columns: 1fr; }
        }

        /* â”€â”€ ëª¨ë°”ì¼ â”€â”€ */
        @media (max-width:768px) {
            body { padding: 10px; }
            .container { width:100%; max-width:100%; }
            h1 { font-size: 1.35em; }
            header { padding: 14px 12px 12px; margin-bottom: 12px; }
            .chart-grid { grid-template-columns: 1fr; gap:14px; margin-bottom:14px; }
            .chart-container { padding: 12px 10px 10px; width:100%; }
            .chart-title { font-size: 0.95em; padding-bottom:8px; margin-bottom:10px; }
            canvas { max-height:none !important; height:45vh !important; min-height:260px; width:100% !important; }
            .date-filter { padding:12px 10px; gap:8px; margin-bottom:12px; }
            .date-filter label { font-size:0.82em; width:100%; text-align:left; }
            .date-filter input[type="date"] { padding:7px 8px; font-size:0.82em; width:100%; }
            .date-filter button { padding:8px 10px; font-size:0.82em; width:100%; }
            .date-range { font-size:0.88em; padding:9px 10px; margin-bottom:12px; }
            .date-info { padding:3px 7px; font-size:0.88em; }
            .marketing-legend { gap:5px 10px; margin-top:8px; padding-top:8px; }
            .ml-item { font-size:0.68em; white-space:normal; }
            .ml-divider { display:none; }
        }
    </style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="spinner"></div>
        <h2>ë°ì´í„° ë¡œë”© ì¤‘...</h2>
        <p>êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.</p>
    </div>
</div>

<div class="container">
    <header>
        <h1>ğŸ¤– ë¡œë´‡ì²­ì†Œê¸° KPI ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
    </header>

    <div id="statusMessage" class="status hide"></div>

    <div id="mainContent" class="hide">
        <div class="date-filter">
            <label for="startDate">ğŸ“… ì‹œì‘ì¼</label>
            <input type="date" id="startDate" value="2026-01-01">
            <label for="endDate">ğŸ“… ì¢…ë£Œì¼</label>
            <input type="date" id="endDate" value="2026-04-08">
            <button onclick="updateCharts()">ğŸ”„ ê¸°ê°„ ì ìš©</button>
            <button class="btn-refresh" onclick="loadGoogleSheetData()">â†» ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="date-range" id="dateRange">
            <span class="date-info">2026-01-01</span> ~ <span class="date-info">2026-04-08</span>
            <span style="margin-left:10px;">ì´ <strong>98</strong>ì¼</span>
        </div>

        <div class="chart-grid">

            <!-- Chart 1: ì—°ë„ë³„ ë¡œë´‡ì²­ì†Œê¸° -->
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ ì—°ë„ë³„ ë¡œë´‡ì²­ì†Œê¸° ê²€ìƒ‰ëŸ‰ ë¹„êµ</div>
                <canvas id="chart1"></canvas>
                <p class="legend-info">25ë…„ vs 26ë…„ ë¡œë´‡ì²­ì†Œê¸° ê²€ìƒ‰ íŠ¸ë Œë“œ</p>
            </div>

            <!-- Chart 2: ì—°ë„ë³„ ë¡œë³´ë½ â˜… ìŒì˜ (ë¼ë²¨ ì—†ìŒ, í•˜ë‹¨ ë²”ë¡€) -->
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ ì—°ë„ë³„ ë¡œë³´ë½ ê²€ìƒ‰ëŸ‰ ë¹„êµ</div>
                <canvas id="chart2"></canvas>
                <div class="marketing-legend">
                    <div class="ml-item"><span class="ml-box ml-box-green"></span>25ë…„ ì‚¬ì „ë§ˆì¼€íŒ… (02.05â€“02.20)</div>
                    <div class="ml-item"><span class="ml-dash ml-dash-green"></span>25ë…„ S10 ëŸ°ì¹­ (02.21)</div>
                    <div class="ml-divider"></div>
                    <div class="ml-item"><span class="ml-box ml-box-red"></span>26ë…„ ì‚¬ì „ë§ˆì¼€íŒ… (02.15â€“02.26)</div>
                    <div class="ml-item"><span class="ml-dash ml-dash-red"></span>26ë…„ S10 ëŸ°ì¹­ (02.27)</div>
                </div>
            </div>

            <!-- Chart 3: ì œí’ˆ ëª¨ë¸ë³„ â˜… ìŒì˜ (ë¼ë²¨ ì—†ìŒ, í•˜ë‹¨ ë²”ë¡€) -->
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ ì œí’ˆ ëª¨ë¸ë³„ ê²€ìƒ‰ëŸ‰ ì¶”ì´</div>
                <canvas id="chart3"></canvas>
                <div class="marketing-legend">
                    <div class="ml-item"><span class="ml-box ml-box-green"></span>25ë…„ ì‚¬ì „ë§ˆì¼€íŒ… (02.05â€“02.20)</div>
                    <div class="ml-item"><span class="ml-dash ml-dash-green"></span>25ë…„ S10 ëŸ°ì¹­ (02.21)</div>
                    <div class="ml-divider"></div>
                    <div class="ml-item"><span class="ml-box ml-box-red"></span>26ë…„ ì‚¬ì „ë§ˆì¼€íŒ… (02.15â€“02.26)</div>
                    <div class="ml-item"><span class="ml-dash ml-dash-red"></span>26ë…„ S10 ëŸ°ì¹­ (02.27)</div>
                </div>
            </div>

            <!-- Chart 4: ê²½ìŸì‚¬ ë¶„ì„ â˜… Xì¶• í•˜ë‹¨ íƒ€ì„ë¼ì¸ -->
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ ê²½ìŸì‚¬ ë¶„ì„ (4ê°œ ì œí’ˆ)</div>
                <canvas id="chart4"></canvas>
                <p class="legend-info" style="margin-top:6px;">ë¡œë³´ë½ S10 Max V Ultra &nbsp;Â·&nbsp; ì‚¼ì„±ë¹„ìŠ¤í¬í¬AIìŠ¤íŒ€ &nbsp;Â·&nbsp; ë“œë¦¬ë¯¸X60 &nbsp;Â·&nbsp; ì—ì½”ë°±ìŠ¤T90</p>
            </div>

        </div><!-- /chart-grid -->
    </div><!-- /mainContent -->
</div><!-- /container -->

<script>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìƒìˆ˜
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTYbyHRNM0Mtm47UkGFPSaHA0vVJER1imwpttDebMaJHr1jqDgL-P3eI7POuMYpKQ/pub?gid=169813989&single=true&output=csv";
    const CORS_PROXIES = [
        'https://corsproxy.io/?',
        'https://api.allorigins.win/raw?url='
    ];

    /*
     * ë§ˆì¼€íŒ… ì´ë²¤íŠ¸ ë‚ ì§œ
     * ë‚ ì§œ ì¶• = 2026ë…„ ê¸°ì¤€ (25ë…„ ë°ì´í„°ë„ 2026 ë‚ ì§œ í–‰ì— ë‚˜ë€íˆ ì €ì¥ëœ êµ¬ì¡°)
     *
     * [ë¡œë³´ë½] 25ë…„: ì‚¬ì „ 02.05~02.20, ëŸ°ì¹­ 02.21
     *          26ë…„: ì‚¬ì „ 02.15~02.26, ëŸ°ì¹­ 02.27
     * [ì‚¼ì„±]        ì‚¬ì „ì˜ˆì•½ 02.11~03.02, ëŸ°ì¹­ 03.03
     * [ë“œë¦¬ë¯¸]      ì‚¬ì „ë§ˆì¼€íŒ… 02.23~03.08, ëŸ°ì¹­ 03.09
     */
    const EVT = {
        // ë¡œë³´ë½ 25ë…„ (ì´ˆë¡)
        rr25PreStart : '2026-02-05',
        rr25PreEnd   : '2026-02-20',
        rr25Launch   : '2026-02-21',
        // ë¡œë³´ë½ 26ë…„ (ë¹¨ê°•)
        rr26PreStart : '2026-02-15',
        rr26PreEnd   : '2026-02-26',
        rr26Launch   : '2026-02-27',
        // ì‚¼ì„± (ì§„íŒŒë‘)
        ssPreStart   : '2026-02-11',
        ssPreEnd     : '2026-03-02',
        ssLaunch     : '2026-03-03',
        // ë“œë¦¬ë¯¸ (í•˜ëŠ˜íŒŒë‘)
        dmPreStart   : '2026-02-23',
        dmPreEnd     : '2026-03-08',
        dmLaunch     : '2026-03-09'
    };

    let allData = [];
    let charts  = {};

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìœ í‹¸
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showStatus(msg, type) {
        const el = document.getElementById('statusMessage');
        el.textContent = msg;
        el.className = 'status ' + type;
        el.classList.remove('hide');
        if (type === 'success') setTimeout(() => el.classList.add('hide'), 3000);
    }
    function showLoading(show) {
        document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
    }
    function cleanNumber(value) {
        if (value === null || value === undefined || value === '' || value === '-') return null;
        if (typeof value === 'number') return value === 0 ? null : value;
        const num = parseFloat(String(value).replace(/[,\s]/g, ''));
        return (isNaN(num) || num === 0) ? null : num;
    }
    function formatK(value) {
        if (value === null || value === undefined) return '';
        return value >= 1000 ? (value / 1000).toFixed(1) + 'k' : Math.round(value).toString();
    }
    function calcYRange(datasets) {
        const vals = datasets.flatMap(d => d.data.map(p => p.y)).filter(v => v != null);
        if (!vals.length) return { min: 0, max: 10000 };
        const mn = Math.min(...vals), mx = Math.max(...vals);
        const pad = (mx - mn) * 0.1;
        return {
            min: Math.max(0, Math.floor((mn - pad) / 100) * 100),
            max: Math.ceil((mx + pad) / 100) * 100
        };
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       CORS fetch
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function tryFetch(proxy, url) {
        const res = await fetch(proxy + encodeURIComponent(url), { headers: { 'Accept': 'text/csv,*/*' } });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.text();
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°ì´í„° ë¡œë“œ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function loadGoogleSheetData() {
        showLoading(true);
        let csvText = null;
        for (const proxy of CORS_PROXIES) {
            try { csvText = await tryFetch(proxy, GOOGLE_SHEET_URL); break; }
            catch(e) {}
        }
        if (!csvText) {
            try { const r = await fetch(GOOGLE_SHEET_URL); if (r.ok) csvText = await r.text(); } catch(e) {}
        }
        if (!csvText) {
            showLoading(false);
            showStatus('âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            return;
        }
        Papa.parse(csvText, {
            header: true, skipEmptyLines: true,
            complete(results) {
                allData = results.data.map(row => {
                    const out = {};
                    Object.keys(row).forEach(k => {
                        if (k === 'ë‚ ì§œ' || k.includes('ë‚ ì§œ')) out['ë‚ ì§œ'] = row[k];
                        else out[k] = cleanNumber(row[k]);
                    });
                    return out;
                });
                showLoading(false);
                document.getElementById('mainContent').classList.remove('hide');
                showStatus(`âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ! (${allData.length}ê°œ ë ˆì½”ë“œ)`, 'success');
                updateCharts();
            },
            error(err) {
                showLoading(false);
                showStatus('âŒ íŒŒì‹± ì˜¤ë¥˜: ' + err.message, 'error');
            }
        });
    }

    function filterData(data, start, end) {
        return data.filter(d => d['ë‚ ì§œ'] >= start && d['ë‚ ì§œ'] <= end);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     * Annotation ë¹Œë” A: ë¡œë³´ë½ ë§ˆì¼€íŒ… ì´ë²¤íŠ¸ (ì°¨íŠ¸ 2Â·3)
     *   - 25ë…„ ì´ˆë¡, 26ë…„ ë¹¨ê°•
     *   - ê·¸ë˜í”„ ìœ„ ë¼ë²¨ ì¹© ì™„ì „ ì œê±° (label.display: false)
     *   - ìŒì˜ ë°•ìŠ¤ + ì ì„ ë§Œ í‘œì‹œ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function buildRoborockAnnotations() {
        return {
            // â”€â”€ 25ë…„ ì‚¬ì „ë§ˆì¼€íŒ… ìŒì˜ (ì´ˆë¡) â”€â”€
            rr25Box: {
                type: 'box',
                xMin: EVT.rr25PreStart,
                xMax: EVT.rr25PreEnd,
                backgroundColor: 'rgba(34,197,94,0.12)',
                borderColor: 'rgba(34,197,94,0.35)',
                borderWidth: 1,
                label: { display: false }
            },
            // â”€â”€ 25ë…„ ëŸ°ì¹­ ìˆ˜ì§ ì ì„  (ì´ˆë¡) â”€â”€
            rr25Line: {
                type: 'line',
                xMin: EVT.rr25Launch,
                xMax: EVT.rr25Launch,
                borderColor: 'rgba(22,163,74,0.85)',
                borderWidth: 1.8,
                borderDash: [6, 4],
                label: { display: false }
            },
            // â”€â”€ 26ë…„ ì‚¬ì „ë§ˆì¼€íŒ… ìŒì˜ (ë¹¨ê°•) â”€â”€
            rr26Box: {
                type: 'box',
                xMin: EVT.rr26PreStart,
                xMax: EVT.rr26PreEnd,
                backgroundColor: 'rgba(220,38,38,0.09)',
                borderColor: 'rgba(220,38,38,0.32)',
                borderWidth: 1,
                label: { display: false }
            },
            // â”€â”€ 26ë…„ ëŸ°ì¹­ ìˆ˜ì§ ì ì„  (ë¹¨ê°•) â”€â”€
            rr26Line: {
                type: 'line',
                xMin: EVT.rr26Launch,
                xMax: EVT.rr26Launch,
                borderColor: 'rgba(220,38,38,0.85)',
                borderWidth: 1.8,
                borderDash: [6, 4],
                label: { display: false }
            }
        };
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     * Annotation ë¹Œë” B: ê²½ìŸì‚¬ ì´ìŠˆ ì¼ì • (ì°¨íŠ¸ 4)
     *   â˜… ê·¸ë˜í”„ ìœ„ ìŒì˜ ì™„ì „ ì œê±° â†’ Xì¶• í•˜ë‹¨ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ëŒ€ì²´
     *   â†’ annotationì€ ë¹ˆ ê°ì²´ ë°˜í™˜ (í”ŒëŸ¬ê·¸ì¸ì´ ì§ì ‘ ê·¸ë¦¼)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function buildCompetitorAnnotations() {
        return {}; // íƒ€ì„ë¼ì¸ í”ŒëŸ¬ê·¸ì¸ì´ ëŒ€ì²´
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     * â˜… ì»¤ìŠ¤í…€ í”ŒëŸ¬ê·¸ì¸: Xì¶• í•˜ë‹¨ ë¸Œëœë“œë³„ íƒ€ì„ë¼ì¸ ë°”
     *   ì°¨íŠ¸ 4 ì „ìš©. afterDraw í›…ìœ¼ë¡œ ìº”ë²„ìŠ¤ì— ì§ì ‘ ê·¸ë¦¼.
     *   - ë°°ê²½ íŠ¸ë™ + ìƒ‰ìƒ ë°” + ëŸ°ì¹­ ìˆ˜ì§ì„  + ë¸Œëœë“œëª… í…ìŠ¤íŠ¸
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const timelinePlugin = {
        id: 'chart4Timeline',
        afterDraw(chart) {
            if (chart.canvas.id !== 'chart4') return;

            const ctx   = chart.ctx;
            const xAxis = chart.scales.x;
            const area  = chart.chartArea;

            // ë‚ ì§œ(ISO string) â†’ xí”½ì…€. ì°¨íŠ¸ ë²”ìœ„ ë°–ì€ í´ë¨í”„.
            const toX = (iso) => {
                const ms = luxon.DateTime.fromISO(iso).toMillis();
                const px = xAxis.getPixelForValue(ms);
                return Math.max(area.left, Math.min(area.right, px));
            };
            // ë‚ ì§œê°€ ì°¨íŠ¸ xë²”ìœ„ ì•ˆì— ìˆëŠ”ì§€ ì—¬ë¶€
            const inRange = (iso) => {
                const ms = luxon.DateTime.fromISO(iso).toMillis();
                return ms >= xAxis.min && ms <= xAxis.max;
            };
            const eitherInRange = (s, e) => {
                const sMs = luxon.DateTime.fromISO(s).toMillis();
                const eMs = luxon.DateTime.fromISO(e).toMillis();
                return eMs >= xAxis.min && sMs <= xAxis.max;
            };

            /* íƒ€ì„ë¼ì¸ í–‰ ì •ì˜ */
            const ROW_H  = 14;   // í–‰ ë†’ì´
            const ROW_G  = 3;    // í–‰ ê°„ê²©
            const OFFSET = 28;   // Xì¶• ëˆˆê¸ˆ í…ìŠ¤íŠ¸ ì•„ë˜ ì—¬ë°±
            const LBL_W  = 42;   // ë¸Œëœë“œëª… ì˜ì—­ ë„ˆë¹„
            const startY = area.bottom + OFFSET;
            const isMob  = chart.width < 480;

            const rows = [
                {
                    /* 1í–‰: ì‚¼ì„± â€” ì‚¬ì „ì˜ˆì•½ 02.11 ì‹œì‘ (ê°€ì¥ ë¹ ë¦„) */
                    label: 'ì‚¼ì„±',
                    labelColor: '#1e40af',
                    segments: [
                        { start: EVT.ssPreStart, end: EVT.ssPreEnd, fill: 'rgba(30,64,175,0.42)' }
                    ],
                    lines: [
                        { date: EVT.ssLaunch, color: 'rgba(30,64,175,1)', label: isMob ? '' : '3.3ëŸ°ì¹­' }
                    ]
                },
                {
                    /* 2í–‰: ë¡œë³´ë½ â€” 26ë…„ ì¼ì •ë§Œ (ì‚¬ì „ 02.15 ì‹œì‘) */
                    label: 'ë¡œë³´ë½',
                    labelColor: '#dc2626',
                    segments: [
                        { start: EVT.rr26PreStart, end: EVT.rr26PreEnd, fill: 'rgba(220,38,38,0.45)' }
                    ],
                    lines: [
                        { date: EVT.rr26Launch, color: 'rgba(220,38,38,1)', label: isMob ? '' : '2.27ëŸ°ì¹­' }
                    ]
                },
                {
                    /* 3í–‰: ë“œë¦¬ë¯¸ â€” ì‚¬ì „ë§ˆì¼€íŒ… 02.23 ì‹œì‘ (ê°€ì¥ ëŠ¦ìŒ) */
                    label: 'ë“œë¦¬ë¯¸',
                    labelColor: '#3b82f6',
                    segments: [
                        { start: EVT.dmPreStart, end: EVT.dmPreEnd, fill: 'rgba(96,165,250,0.55)' }
                    ],
                    lines: [
                        { date: EVT.dmLaunch, color: 'rgba(96,165,250,1)', label: isMob ? '' : '3.9ëŸ°ì¹­' }
                    ]
                }
            ];

            ctx.save();

            rows.forEach((row, i) => {
                const y = startY + i * (ROW_H + ROW_G);

                /* â‘  íŠ¸ë™ ë°°ê²½ (íšŒìƒ‰ ë°”) */
                ctx.fillStyle = 'rgba(0,0,0,0.06)';
                ctx.beginPath();
                ctx.roundRect
                    ? ctx.roundRect(area.left + LBL_W, y, area.right - area.left - LBL_W, ROW_H, 3)
                    : ctx.rect(area.left + LBL_W, y, area.right - area.left - LBL_W, ROW_H);
                ctx.fill();

                /* â‘¡ ë¸Œëœë“œëª… í…ìŠ¤íŠ¸ */
                ctx.fillStyle = row.labelColor;
                ctx.font = `bold ${isMob ? 9 : 10}px -apple-system, sans-serif`;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText(row.label, area.left + 2, y + ROW_H / 2);

                /* â‘¢ í´ë¦¬í•‘ ì˜ì—­ = íŠ¸ë™ë§Œ */
                ctx.save();
                ctx.beginPath();
                ctx.rect(area.left + LBL_W, y - 1, area.right - area.left - LBL_W, ROW_H + 2);
                ctx.clip();

                /* â‘£ ìƒ‰ìƒ ì„¸ê·¸ë¨¼íŠ¸ ë°” */
                row.segments.forEach(seg => {
                    if (!eitherInRange(seg.start, seg.end)) return;
                    const x1 = toX(seg.start);
                    const x2 = toX(seg.end);
                    ctx.fillStyle = seg.fill;
                    ctx.fillRect(x1, y, x2 - x1, ROW_H);
                });

                /* â‘¤ ëŸ°ì¹­ ìˆ˜ì§ì„  + í…ìŠ¤íŠ¸ */
                row.lines.forEach(ln => {
                    if (!inRange(ln.date)) return;
                    const x = toX(ln.date);
                    ctx.strokeStyle = ln.color;
                    ctx.lineWidth = 2;
                    ctx.setLineDash([4, 3]);
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x, y + ROW_H);
                    ctx.stroke();
                    ctx.setLineDash([]);

                    if (ln.label) {
                        ctx.fillStyle = ln.color;
                        ctx.font = `${isMob ? 7 : 8}px -apple-system, sans-serif`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(ln.label, x, y + ROW_H / 2);
                    }
                });

                ctx.restore(); /* í´ë¦¬í•‘ í•´ì œ */
            });

            ctx.restore();
        }
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     * (ë”ë¯¸ ìœ ì§€) â€” buildCompetitorAnnotations ì•„ë˜ ì¶”ê°€ë¡œ ì°¸ì¡°ë˜ì§€ ì•ŠìŒ
     * â˜… ì‚¼ì„± ì‚¬ì „ì˜ˆì•½ ìŒì˜ (ì§„íŒŒë‘) â€” ì´í•˜ ì½”ë“œëŠ” ìœ„ì—ì„œ ì œê±°ë¨
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function _unusedOldAnnotations() {
        return {
            ssBox: { type:'box', xMin:EVT.ssPreStart, xMax:EVT.ssPreEnd, backgroundColor:'rgba(30,64,175,0.08)', borderWidth:0, label:{display:false} },
            ssLine: { type:'line', xMin:EVT.ssLaunch, xMax:EVT.ssLaunch, borderColor:'rgba(30,64,175,0.5)', borderWidth:1, borderDash:[4,3], label:{display:false} },
            dmBox: { type:'box', xMin:EVT.dmPreStart, xMax:EVT.dmPreEnd, backgroundColor:'rgba(96,165,250,0.08)', borderWidth:0, label:{display:false} },
            dmLine: { type:'line', xMin:EVT.dmLaunch, xMax:EVT.dmLaunch, borderColor:'rgba(96,165,250,0.5)', borderWidth:1, borderDash:[4,3], label:{display:false} }
        };
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ì°¨íŠ¸ ìƒì„±  annotationsObj = null | Object
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function createChart(canvasId, datasets, annotationsObj = null) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        if (charts[canvasId]) charts[canvasId].destroy();

        const isMobile   = window.innerWidth <= 768;
        const isChart4   = canvasId === 'chart4';
        const yRange     = calcYRange(datasets);
        const annotationOpts = annotationsObj
            ? { annotations: annotationsObj }
            : {};
        // ì°¨íŠ¸4: Xì¶• í•˜ë‹¨ íƒ€ì„ë¼ì¸ ê³µê°„ í™•ë³´
        const bottomPad  = isChart4 ? (isMobile ? 62 : 72) : 0;
        // ì°¨íŠ¸4: íƒ€ì„ë¼ì¸ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡
        const pluginList = isChart4 ? [timelinePlugin] : [];

        charts[canvasId] = new Chart(ctx, {
            type: 'line',
            data: { datasets },
            plugins: pluginList,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: { padding: { bottom: bottomPad } },
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: {
                        display: true, position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: isMobile ? 8 : 14,
                            font: { size: isMobile ? 10 : 12 },
                            boxWidth: isMobile ? 8 : 12
                        }
                    },
                    tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(0,0,0,0.82)',
                        padding: isMobile ? 7 : 11,
                        titleFont: { size: isMobile ? 11 : 13 },
                        bodyFont:  { size: isMobile ? 10 : 12 },
                        callbacks: {
                            label(c) {
                                if (c.parsed.y === null) return null;
                                return (c.dataset.label || '') + ': ' + formatK(c.parsed.y);
                            }
                        }
                    },
                    annotation: annotationOpts
                },
                scales: {
                    x: {
                        type: 'time',
                        time: { unit: 'day', displayFormats: { day: 'MM/dd' } },
                        title: { display: false },
                        grid: { display: false },
                        ticks: {
                            font: { size: isMobile ? 8 : 11 },
                            maxRotation: isMobile ? 45 : 0,
                            autoSkip: true,
                            maxTicksLimit: isMobile ? 5 : 10
                        }
                    },
                    y: {
                        suggestedMin: yRange.min,
                        suggestedMax: yRange.max,
                        title: { display: false },
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            font: { size: isMobile ? 9 : 11 },
                            callback: v => formatK(v)
                        }
                    }
                }
            }
        });
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìƒ‰ìƒ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const C = {
        green25  : 'rgb(34,197,94)',    // 25ë…„ ë¡œë³´ë½ / S9
        red26    : 'rgb(220,38,38)',    // 26ë…„ ë¡œë³´ë½ / S10
        blue     : 'rgb(59,130,246)',   // 25ë…„ ë¡œë´‡ì²­ì†Œê¸°
        red      : 'rgb(239,68,68)',    // 26ë…„ ë¡œë´‡ì²­ì†Œê¸°
        samsung  : 'rgb(30,64,175)',    // ì‚¼ì„± ì§„íŒŒë‘
        dreame   : 'rgb(96,165,250)',   // ë“œë¦¬ë¯¸ í•˜ëŠ˜íŒŒë‘
        ecovacs  : 'rgb(120,53,15)'    // ì—ì½”ë°±ìŠ¤ ê°ˆìƒ‰
    };

    function ds(label, data, color) {
        return {
            label, data,
            borderColor: color, backgroundColor: 'transparent',
            borderWidth: 2.5, tension: 0.4, fill: false,
            pointRadius: 0, pointHoverRadius: 4, spanGaps: false
        };
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function updateCharts() {
        if (!allData.length) return;
        const start = document.getElementById('startDate').value;
        const end   = document.getElementById('endDate').value;
        if (!start || !end) { alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

        const fd = filterData(allData, start, end);
        if (!fd.length) { alert('ì„ íƒ ê¸°ê°„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

        document.getElementById('dateRange').innerHTML =
            `<span class="date-info">${start}</span> ~ <span class="date-info">${end}</span>` +
            `<span style="margin-left:10px;">ì´ <strong>${fd.length}</strong>ì¼</span>`;

        const pt = (d, k) => ({ x: d['ë‚ ì§œ'], y: d[k] });

        // Chart 1 â€“ ì—°ë„ë³„ ë¡œë´‡ì²­ì†Œê¸° (ìŒì˜ ì—†ìŒ)
        createChart('chart1', [
            ds('25 ë¡œë´‡ì²­ì†Œê¸°', fd.map(d => pt(d, '25 ë¡œë´‡ì²­ì†Œê¸°')), C.blue),
            ds('26 ë¡œë´‡ì²­ì†Œê¸°', fd.map(d => pt(d, '26 ë¡œë´‡ì²­ì†Œê¸°')), C.red)
        ], null);

        // Chart 2 â€“ ì—°ë„ë³„ ë¡œë³´ë½ â˜… ìŒì˜ O / ë¼ë²¨ ì—†ìŒ
        createChart('chart2', [
            ds('25 ë¡œë³´ë½', fd.map(d => pt(d, '25 ë¡œë³´ë½')),  C.green25),
            ds('26 ë¡œë³´ë½', fd.map(d => pt(d, '26 .ë¡œë³´ë½')), C.red26)
        ], buildRoborockAnnotations());

        // Chart 3 â€“ ì œí’ˆ ëª¨ë¸ë³„ â˜… ìŒì˜ O / ë¼ë²¨ ì—†ìŒ
        createChart('chart3', [
            ds('S9 Max V Ultra',  fd.map(d => pt(d, 'S9 Max V Ultra')),  C.green25),
            ds('S10 Max V Ultra', fd.map(d => pt(d, 'S10 Max V Ultra')), C.red26)
        ], buildRoborockAnnotations());

        // Chart 4 â€“ ê²½ìŸì‚¬ ë¶„ì„ â˜… ì‚¼ì„±Â·ë“œë¦¬ë¯¸ ìŒì˜ O / ë¼ë²¨ ì—†ìŒ
        createChart('chart4', [
            ds('ë¡œë³´ë½ S10 Max V Ultra', fd.map(d => pt(d, 'S10 Max V Ultra')),  C.red26),
            ds('ì‚¼ì„±ë¹„ìŠ¤í¬í¬AIìŠ¤íŒ€',      fd.map(d => pt(d, 'ì‚¼ì„±ë¡œë´‡ì²­ì†Œê¸°')),   C.samsung),
            ds('ë“œë¦¬ë¯¸X60',              fd.map(d => pt(d, 'ë“œë¦¬ë¯¸x60')),        C.dreame),
            ds('ì—ì½”ë°±ìŠ¤T90',            fd.map(d => pt(d, 'ì—ì½”ë°±ìŠ¤T90')),      C.ecovacs)
        ], buildCompetitorAnnotations());
    }

    /* ì´ˆê¸°í™” */
    window.addEventListener('DOMContentLoaded', loadGoogleSheetData);
    window.addEventListener('resize', () => { if (allData.length) updateCharts(); });
</script>
</body>
</html>
                 